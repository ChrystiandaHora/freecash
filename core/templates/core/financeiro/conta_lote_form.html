{% extends "core/layout/base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">

  <!-- Header -->
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
    <div>
      <div class="flex items-center gap-3 mb-2">
        <a href="{% url url_voltar %}" class="group p-2 -ml-2 rounded-xl text-gray-400 hover:text-gray-900 dark:text-slate-500 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-slate-800 transition-all" title="Voltar">
          <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i>
        </a>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white tracking-tight flex items-center gap-3">
          <div class="p-2 rounded-xl bg-gradient-to-br {% if tipo == 'receita' %}from-emerald-500/10 to-emerald-600/10 border-emerald-500/20{% else %}from-rose-500/10 to-rose-600/10 border-rose-500/20{% endif %} border">
            <i class="fa-solid fa-layer-group {% if tipo == 'receita' %}text-emerald-600 dark:text-emerald-400{% else %}text-rose-600 dark:text-rose-400{% endif %}"></i>
          </div>
          {{ titulo }}
        </h1>
      </div>
      <p class="text-gray-500 dark:text-slate-400 text-sm md:ml-12">{{ subtitulo }}</p>
    </div>

    <!-- Seletor de Quantidade (Segmented Control) -->
    <div class="bg-gray-100 dark:bg-slate-800 p-1.5 rounded-xl flex items-center gap-1 self-start md:self-center">
        {% for n in "5,10,15"|split:"," %}
        <a href="?qtd={{ n }}" 
           class="px-4 py-2 rounded-lg text-sm font-semibold transition-all relative
                  {% if quantidade|stringformat:"s" == n %}
                    bg-white dark:bg-slate-700 text-gray-900 dark:text-white shadow-sm ring-1 ring-black/5 dark:ring-white/5
                  {% else %}
                    text-gray-500 dark:text-slate-400 hover:text-gray-700 dark:hover:text-slate-200 hover:bg-gray-200/50 dark:hover:bg-slate-700/50
                  {% endif %}">
           {{ n }} linhas
        </a>
        {% endfor %}
    </div>
  </div>

  <!-- Formulário -->
  <form method="post" class="space-y-6">
    {% csrf_token %}

    <!-- Card com Tabela -->
    <div class="bg-white dark:bg-slate-900 border border-gray-100 dark:border-slate-800 rounded-2xl shadow-lg dark:shadow-xl overflow-hidden">
      
      <!-- Header da Tabela -->
      <div class="px-6 py-4 bg-gray-50 dark:bg-slate-800/50 border-b border-gray-100 dark:border-slate-800">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-table-list text-gray-400 dark:text-slate-500"></i>
            <span class="text-sm font-medium text-gray-600 dark:text-slate-300">{{ quantidade }} lançamentos</span>
          </div>
          <span class="text-xs text-gray-400 dark:text-slate-600">Preencha as linhas desejadas • linhas vazias serão ignoradas</span>
        </div>
      </div>

      <!-- Tabela Responsiva -->
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 dark:bg-slate-800/30">
            <tr class="text-left text-xs font-semibold text-gray-500 dark:text-slate-400 uppercase tracking-wider">
              <th class="px-4 py-3 w-12">#</th>
              <th class="px-4 py-3">Descrição *</th>
              <th class="px-4 py-3 w-36">Valor (R$) *</th>
              <th class="px-4 py-3 w-40">{% if tipo == 'receita' %}Data{% else %}Vencimento{% endif %} *</th>
              <th class="px-4 py-3 w-48">Forma de Pagamento</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100 dark:divide-slate-800">
            {% for i in linhas %}
            <tr class="hover:bg-gray-50/50 dark:hover:bg-slate-800/30 transition-colors group">
              <!-- # -->
              <td class="px-4 py-3 text-center">
                <span class="text-xs font-bold text-gray-400 dark:text-slate-600 group-hover:text-gray-600 dark:group-hover:text-slate-400 transition-colors">{{ forloop.counter }}</span>
              </td>
              
              <!-- Descrição -->
              <td class="px-4 py-2">
                <input type="text" name="descricao[]" 
                       placeholder="Ex: {% if tipo == 'receita' %}Salário, Freelance...{% else %}Conta de Luz, Aluguel...{% endif %}"
                       class="w-full bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 focus:border-{% if tipo == 'receita' %}emerald{% else %}rose{% endif %}-500 focus:ring-{% if tipo == 'receita' %}emerald{% else %}rose{% endif %}-500/20 rounded-xl px-3 py-2 text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-500 transition-all font-medium shadow-sm">
              </td>
              
              <!-- Valor -->
              <td class="px-4 py-2">
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-slate-400 text-sm font-bold z-10">R$</span>
                  <input type="text" name="valor[]" 
                         placeholder="0,00"
                         class="w-full bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 focus:border-{% if tipo == 'receita' %}emerald{% else %}rose{% endif %}-500 focus:ring-{% if tipo == 'receita' %}emerald{% else %}rose{% endif %}-500/20 rounded-xl pl-10 pr-3 py-2 text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-500 font-bold transition-all shadow-sm relative z-0">
                </div>
              </td>
              
              <!-- Data -->
              <td class="px-4 py-2">
                <input type="date" name="data[]"
                       class="w-full bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 focus:border-{% if tipo == 'receita' %}emerald{% else %}rose{% endif %}-500 focus:ring-{% if tipo == 'receita' %}emerald{% else %}rose{% endif %}-500/20 rounded-xl px-3 py-2 text-sm text-gray-900 dark:text-white transition-all cursor-pointer shadow-sm">
              </td>
              
              <!-- Forma de Pagamento -->
              <td class="px-4 py-2">
                <select name="forma_pagamento[]"
                        class="w-full bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 focus:border-{% if tipo == 'receita' %}emerald{% else %}rose{% endif %}-500 focus:ring-{% if tipo == 'receita' %}emerald{% else %}rose{% endif %}-500/20 rounded-xl px-3 py-2 text-sm text-gray-700 dark:text-slate-300 cursor-pointer transition-all shadow-sm">
                  <option value="">—</option>
                  {% for f in formas %}
                  <option value="{{ f.id }}">{{ f.nome }}</option>
                  {% endfor %}
                </select>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Footer com Ações -->
      <div class="px-6 py-4 bg-gray-50 dark:bg-slate-800/50 border-t border-gray-100 dark:border-slate-800 flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between">
        
        <!-- Esquerda: Checkbox (se houver) e Info -->
        <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6">
            {% if tipo == 'despesa' %}
            <label class="flex items-center gap-2 cursor-pointer group select-none">
                <input type="checkbox" name="todas_pagas" class="w-4 h-4 rounded border-gray-300 text-rose-600 focus:ring-rose-500 dark:bg-slate-800 dark:border-slate-600 cursor-pointer">
                <span class="text-sm font-medium text-gray-700 dark:text-slate-300 group-hover:text-rose-600 dark:group-hover:text-rose-400 transition-colors">
                    Marcar todas como pagas
                </span>
            </label>
            <div class="hidden sm:block h-4 w-px bg-gray-300 dark:bg-slate-700"></div>
            {% endif %}

            <div class="flex items-center gap-2 text-xs text-gray-500 dark:text-slate-500">
                <i class="fa-solid fa-info-circle"></i>
                <span>Linhas em branco são ignoradas</span>
            </div>
        </div>
        
        <!-- Direita: Botões -->
        <div class="flex gap-3 w-full sm:w-auto">
          <a href="{% url url_voltar %}" 
             class="flex-1 sm:flex-none px-5 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700 text-gray-700 dark:text-slate-300 font-semibold hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors text-center shadow-sm">
            Cancelar
          </a>
          <button type="submit" 
                  class="flex-1 sm:flex-none px-6 py-2.5 rounded-xl font-bold text-white shadow-lg transition-all flex items-center justify-center gap-2
                         {% if tipo == 'receita' %}
                           bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 shadow-emerald-500/20 hover:shadow-emerald-500/40
                         {% else %}
                           bg-gradient-to-r from-rose-600 to-pink-600 hover:from-rose-500 hover:to-pink-500 shadow-rose-500/20 hover:shadow-rose-500/40
                         {% endif %}">
            <i class="fa-solid fa-floppy-disk"></i>
            Salvar Todos
          </button>
        </div>
      </div>
    </div>

  </form>

  <!-- Dica -->
  <div class="p-4 rounded-2xl bg-gray-50 dark:bg-slate-800/50 border border-gray-100 dark:border-slate-800">
    <div class="flex items-start gap-3">
      <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
        <i class="fa-solid fa-lightbulb text-blue-600 dark:text-blue-400 text-sm"></i>
      </div>
      <div>
        <h4 class="text-sm font-semibold text-gray-900 dark:text-white">Dica Rápida</h4>
        <p class="text-sm text-gray-500 dark:text-slate-400 mt-1">
          Use <kbd class="px-1.5 py-0.5 rounded bg-gray-200 dark:bg-slate-700 text-xs font-mono">Tab</kbd> para navegar rapidamente entre os campos. 
          Você pode preencher apenas algumas linhas — as em branco serão ignoradas automaticamente.
        </p>
      </div>
    </div>
  </div>

</div>

<style>
  /* Estilização do date picker em dark mode */
  input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(0.5);
    cursor: pointer;
  }
  .dark input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(1) opacity(0.7);
  }
</style>
{% endblock %}
