{% extends "core/layout/base.html" %}

{% block title %}{% if is_edit %}Editar{% else %}Nova{% endif %} Assinatura - FreeCash{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center gap-3 mb-2">
      <a href="{% url 'assinaturas' %}" class="text-gray-500 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors">
        <i class="fa-solid fa-arrow-left"></i>
      </a>
      <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight text-gray-900 dark:text-white">
        {% if is_edit %}Editar{% else %}Nova{% endif %} Assinatura
      </h1>
    </div>
    <p class="text-sm text-gray-500 dark:text-slate-400">
      {% if is_edit %}Altere os dados da assinatura{% else %}Cadastre um pagamento recorrente{% endif %}
    </p>
  </div>

  <!-- Form Card -->
  <div class="bg-white dark:bg-slate-800 rounded-2xl border border-gray-100 dark:border-slate-700 shadow-sm overflow-hidden">
    <div class="p-6">
      {% if error %}
      <div class="mb-5 rounded-xl border border-red-200 dark:border-red-900 bg-red-50 dark:bg-red-900/20 px-4 py-3">
        <div class="flex items-center gap-3">
          <i class="fa-solid fa-circle-exclamation text-red-500"></i>
          <p class="text-sm font-medium text-red-800 dark:text-red-300">{{ error }}</p>
        </div>
      </div>
      {% endif %}

      <form method="post" class="space-y-5">
        {% csrf_token %}

        <!-- Descrição -->
        <div class="space-y-1.5">
          <label for="descricao" class="text-sm font-medium text-gray-700 dark:text-slate-300 ml-1 flex items-center gap-2">
            <i class="fa-regular fa-file-lines text-gray-400 dark:text-gray-500"></i>
            Descrição
          </label>
          <input
            type="text"
            name="descricao"
            id="descricao"
            value="{% if assinatura %}{{ assinatura.descricao }}{% endif %}"
            required
            placeholder="Ex: Netflix, Aluguel, Internet..."
            class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
          />
        </div>

        <!-- Valor e Tipo -->
        <div class="grid grid-cols-2 gap-4">
          <div class="space-y-1.5">
            <label for="valor" class="text-sm font-medium text-gray-700 dark:text-slate-300 ml-1 flex items-center gap-2">
              <i class="fa-regular fa-dollar-sign text-gray-400 dark:text-gray-500"></i>
              Valor
            </label>
            <input
              type="text"
              name="valor"
              id="valor"
              value="{% if assinatura %}{{ assinatura.valor }}{% endif %}"
              required
              placeholder="0,00"
              class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
            />
          </div>

          <div class="space-y-1.5">
            <label for="tipo" class="text-sm font-medium text-gray-700 dark:text-slate-300 ml-1 flex items-center gap-2">
              <i class="fa-regular fa-arrows-up-down text-gray-400 dark:text-gray-500"></i>
              Tipo
            </label>
            <select
              name="tipo"
              id="tipo"
              class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
            >
              <option value="D" {% if assinatura and assinatura.tipo == 'D' %}selected{% endif %}>Despesa</option>
              <option value="R" {% if assinatura and assinatura.tipo == 'R' %}selected{% endif %}>Receita</option>
            </select>
          </div>
        </div>

        <!-- Dia de Vencimento e Próxima Geração -->
        <div class="grid grid-cols-2 gap-4">
          <div class="space-y-1.5">
            <label for="dia_vencimento" class="text-sm font-medium text-gray-700 dark:text-slate-300 ml-1 flex items-center gap-2">
              <i class="fa-regular fa-calendar text-gray-400 dark:text-gray-500"></i>
              Dia de Vencimento
            </label>
            <select
              name="dia_vencimento"
              id="dia_vencimento"
              class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
            >
              {% for i in "12345678901234567890123456789012"|make_list %}
              {% if forloop.counter <= 31 %}
              <option value="{{ forloop.counter }}" {% if assinatura and assinatura.dia_vencimento == forloop.counter %}selected{% endif %}>
                {{ forloop.counter|stringformat:"02d" }}
              </option>
              {% endif %}
              {% endfor %}
            </select>
          </div>

          <div class="space-y-1.5">
            <label for="proxima_geracao" class="text-sm font-medium text-gray-700 dark:text-slate-300 ml-1 flex items-center gap-2">
              <i class="fa-regular fa-calendar-plus text-gray-400 dark:text-gray-500"></i>
              Próxima Geração
            </label>
            <input
              type="date"
              name="proxima_geracao"
              id="proxima_geracao"
              value="{% if assinatura %}{{ assinatura.proxima_geracao|date:'Y-m-d' }}{% else %}{{ proxima_geracao }}{% endif %}"
              required
              class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
            />
          </div>
        </div>

        <!-- Categoria e Forma de Pagamento -->
        <div class="grid grid-cols-2 gap-4">
          <div class="space-y-1.5">
            <label for="categoria" class="text-sm font-medium text-gray-700 dark:text-slate-300 ml-1 flex items-center gap-2">
              <i class="fa-regular fa-folder text-gray-400 dark:text-gray-500"></i>
              Categoria
            </label>
            <select
              name="categoria"
              id="categoria"
              class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
            >
              <option value="">Sem categoria</option>
              {% for cat in categorias %}
              <option value="{{ cat.id }}" {% if assinatura and assinatura.categoria_id == cat.id %}selected{% endif %}>
                {{ cat.nome }}
              </option>
              {% endfor %}
            </select>
          </div>

          <div class="space-y-1.5">
            <label for="forma_pagamento" class="text-sm font-medium text-gray-700 dark:text-slate-300 ml-1 flex items-center gap-2">
              <i class="fa-regular fa-credit-card text-gray-400 dark:text-gray-500"></i>
              Forma de Pagamento
            </label>
            <select
              name="forma_pagamento"
              id="forma_pagamento"
              class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
            >
              <option value="">Nenhuma</option>
              {% for fp in formas_pagamento %}
              <option value="{{ fp.id }}" {% if assinatura and assinatura.forma_pagamento_id == fp.id %}selected{% endif %}>
                {{ fp.nome }}
              </option>
              {% endfor %}
            </select>
          </div>
        </div>

        {% if is_edit %}
        <!-- Ativa (só no edit) -->
        <div class="flex items-center gap-3 pt-2">
          <label class="relative inline-flex items-center cursor-pointer">
            <input
              type="checkbox"
              name="ativa"
              id="ativa"
              {% if assinatura.ativa %}checked{% endif %}
              class="sr-only peer"
            />
            <div class="w-11 h-6 bg-gray-300 dark:bg-slate-600 rounded-full peer peer-checked:bg-emerald-500 peer-focus:ring-2 peer-focus:ring-emerald-500/50 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
          </label>
          <span class="text-sm font-medium text-gray-700 dark:text-slate-300">Assinatura ativa</span>
        </div>
        {% endif %}

        <!-- Submit -->
        <div class="pt-4">
          <button
            type="submit"
            class="w-full inline-flex items-center justify-center gap-3 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 px-6 py-4 text-base font-bold text-white hover:from-emerald-600 hover:to-teal-700 active:scale-[0.98] transition-all shadow-lg shadow-emerald-500/30"
          >
            <i class="fa-solid {% if is_edit %}fa-check{% else %}fa-plus{% endif %}"></i>
            {% if is_edit %}Salvar Alterações{% else %}Criar Assinatura{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
